# 知识
## 认证授权
- basic	 baerer	 token	 jwt  oauth

### JWT（JSON Web Token）
1. 定义
    1. 是一种认证协议
    2. JWT提供了一种用于发布接入令牌（Access Token),并对发布的签名接入令牌进行验证的方法。 
    3. 令牌（Token）本身包含了一系列声明，应用程序可以根据这些声明限制用户对资源的访问。

2. 一个Token包含三部分：
- header.claims.signature
    1. Header 头部分简单声明了类型(JWT)以及产生签名所使用的算法。
    2. Claims 声明部分是整个token的核心，表示要发送的用户详细信息。
    3. Signature 签名的目的是为了保证上边两部分信息不被篡改。
    ```js
    jwt.sign(payload, secretOrPrivateKey, [options, callback])
    jwt.verify（token，secretOrPublicKey，[options，callback]）
    ```


### OAuth2是一种授权框架
- 是一种授权框架，提供了一套详细的授权机制（指导）。用户或应用可以通过公开的或私有的设置，授权第三方应用访问特定资源。
- 参考 https://blog.csdn.net/keets1992/article/details/104103814
#### 角色
1. resource owner
2. resource server
3. client 
4. authorization server
#### 授权方式
1. 授权码方式
2. 密码方式
### base64
```bat
window.btoa("test")；// "dGVzdA=="
window.atob("dGVzdA=="); //"test"
```

## 授权
- ACL  RBAC  ABAC

### RBAC
1. RBAC0
    用户 角色 权限  会话
2. RBAC1
    角色分层，角色继承
3. RBAC2 
    静态职责分离，动态职责分离，角色互斥
4. RBAC2 
    RBAC1 和 RBAC2 的结合

# 单点登陆&授权系统
## 背景
1. 公司里面有不同的业务系统，业务系统可能会有不同的模块，各个系统是独自运营的，各个模块是由不同的工程师开发的。
2. 需要一个单点登陆&授权 SSO系统，用户未登陆则跳转到SSO系统进行登陆，然后SSO验证并授权给用户(通过token)，下次用户就可以直接以不同的权限进入不同的业务系统。
- 具体需求： 
    1. 满足登录一次，就可以操作各个业务系统。
    2. 如果有业务系统对接进来，可以无缝对接。
    3. 不同的角色只能执行对应系统的对应功能。
## 调研
1. go-admin 数据可视化管理平台搭建框架，提供了流量监控登陆验证权限管理等功能，软件工程师只需要基于go-admin这个项目框架写 业务。 不适合
2. casbin包 嵌入进代码里，提供各种基于API的授权方案。 不适合
3. oauth包 ， 应用于 服务A访问服务B的资源，需要获取服务B的认证。 不适合

## 概述
SSO（单点登陆&授权系统）系统 为各个业务系统的进行统一的登陆授权，任何业务系统都可以无缝的对接进来。

## 设计
### 思想
用户/角色
操作/API/菜单
对象/资源/数据
1. SSO系统 用户/角色  和 操作/API/菜单 的绑定 
2. 业务系统 用户/角色  和 对象/资源/数据 的绑定 

### 数据库设计
1. 用户表
2. 用户组表
3. 业务系统表
4. API权限表
5. Menu权限表
    1. 菜单，子菜单
    2. 和前端确定菜单，给予每个菜单一个编号（沟通）
6. 角色表
    1. 包含了API权限和Menu权限
7. 用户与用户组关联表
8. API权限与角色关联表
9. Menu权限与角色关联表

### 功能设计
#### 权限与角色的配置
1. API权限表配置
2. Menu权限表配置
3. 配置角色
4. 角色和API的关联
5. 角色和Menu的关联

#### 用户与用户组的配置
1. 对接ldap导入所有的用户进数据库。（完成）
2. 用户的配置
3. 用户和用户组的关联

#### 角色与用户组
1. 角色与用户组的绑定

#### 单点登陆
1. 验证用户账户密码是否匹配，匹配则返回携带用户角色信息的token

#### 权限认证
1. 用过用户id获取用户所属的角色
2. 通过角色判定用户是否具有某个系统的API的权限

## 业务系统使用
### 前端
1. 前端存储所有自生需要的角色信息，通过 角色 判断显示哪些菜单
### 后端
- 方案一 后端存储所有自生需要的角色信息，通过角色判断用户是是否有权限调用这个API
- 方案二 后端API被请求时，后端会先去请求SSO系统的，SSO系统判断此角色是否有调用此API的权限
