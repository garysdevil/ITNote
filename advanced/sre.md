
- 公司的文化，公司的运维文化
- 在运行维护中，结果导向是一种错误，过程与结果一样重要。
# SRE
- 什么是SRE
    - 站点可靠性工程师
    - 使用软件工程的方法解决复杂的运维问题

- 软件的生命周期
    - 需求分析  需求分析工程师、产品经理
    - 软件设计  架构工程师
    - 程序编码  研发工程师
    - 软件测试  测试工程师
    - 运行维护  运维工程师

- 运行维护是软件生命周期中持续时间最长的阶段，运维工程师是一个非常重要的角色。


- 研发工程师和运维工程师的矛盾
    变与不变
    - 随时随地发布新功能，没有任何阻拦。
    - 一旦一个东西在生产环境中正常工作了，就不要再进行任何改动。


- 如何避免琐事
    - 负责运维的整个服务的团队成员必须要有足够的时间编程，否则他们会被运维工作所淹没。
    - 任何的手工操作必须控制在百分之50的时间内，至少保留百分之50的时间用于自动化开发上。

- 职责
    - 可用性改进，延迟优化、性能优化一下、效率优化、变更管理、监控、紧急事务处理、容量规划与管理

- 根本解决问题：在每8～12小时的on-call期间，最多只处理2个紧急事件，这个准则保证on-call工程师有足够的时间根据紧急事件，正确地处理故障，恢复故障，撰写一份事后报告。

- 为什么需要K8S
    - 把硬件故障和实际业务用户隔离开来
    - 业务团队运行软件服务时不需要担心硬件故障
    - 容器编排，自动重启，快速扩容，生命式管理服务，服务健康检查自动修复
- 为什么需要request和limit
    - 一个缓慢的不断重启的Pod，要好过一个永远不重启一直泄露资源的Pod。

- 监控
    - 对真实问题进行报警
    - 对比服务更新前后的状态变化，新的版本是否让软件运行得更快？
    - 检查资源使用量随着时间的变化情况（制定合理的资源变化）

- 迭代与稳定
    - 定制SLO（服务目标水平），根据实际情况，进行调节
    - 如果研发迭代导致的时间超过了我们这个月需要达到的服务目标水平，则停止这个月份的发布

- 加法与减法
    - 我们的监控越来越多，我们的告警越来越多

- 琐事
    - 手动的，重复性的，可以被自动化的，战术上没有持久价值的工作。
- 工程工作
    - 符合长期战略的，会对你的服务进行长久性改善的工作。
    - 通常是有创新性和创造性的，着重通过设计来解决问题，解决方案越通用越好。
    - 例如：编写优化自动化脚本；监控部署，系统参数调优，架构设计优化；自动化重复工作。

- 牺牲工程实践而做琐事，会对SRE组织整体的发展造成损害。


### 监控
- 分析长期趋势 -- 容量调整

- 观察某一个参数改变后产生的变化（跨时间范围的比较）  -- 优化

- 报警

- 临时性回溯分析（例如刚刚延迟大幅度增加，有什么其它的现象也发生了）


- 4个监控黄金指标
    - 延迟
    - 流量
        - 每秒钟HTTP请求速率等
    - 错误
    - 饱和度
        - 内存剩余量、CPU利用率等等

- 注意：平均值、长尾值

- 简化，直到不能再简化
    - 一个季度内都没有使用到的指标可以评估是否删除掉
    - 收集的数据，却没有拿来 观察 或者 告警

- 数据收集、数据观察、告警、事故跟踪

### 自动化
- 自动化的价值
    - 一致性
    - 平台性（可以理解为普遍性，广泛适用，符合成本收益）
    - 修复速度更快，行动速度更快
    - 节省时间

- 如果我们持续产生不可自动化的流程和解决方案，我们就继续需要人来进行系统维护，如果我们需要雇佣人来做这项工作，就像是用人类的鲜血、汗水和眼泪来养活机器。这就像一个没有特效但充满了愤怒的的系统管理员的Matrix世界。   Joseph Bironas

- 自动化、系统化、自治系统
    - 没有自动化
    - 外部脚本进行自动化
    - 外部通用脚本进行自动化
    - 系统内部脚本进行自动化
    - 系统内部机制自动化

### 发布工程
- 角色：
    - 统计发布速度
    - 统计..

- 任何组织都需要根据自生情况，寻求适合自己的发布策略。

- gary
    - 压测
    - 审查代码
    - 生产环境发布审核

- 代码发布 和 配置发布 的解耦

1. 发布
2. 执行单元测试
2. 编程成二进制文件
3. 系统级集成测试部署
4. 生产环境部署
4. 生成改动列表报告

### 简单
- 最小API
    - 法国诗人 Antoine de Saint Exupery 曾经写道：不是在不能添加更多的时候，而是诶有什么可以去掉的时候，才能达到完美。
    - 这个原则同样适用于软件的设计和构建。例如API的参数最少化。
- 模块化

### 具体实践
- 简单来说，SRE的职责是运维一个服务。该服务由相关的系统组件组成，为最终用户提供服务（可以是内部用户或者外部用户）。SRE的终极责任是确保该服务可以正常运转。为达成这个目标，SRE需要完成以下一系列工作：开发监控系统，规划容量，处理紧急事件，确保事故根源被跟踪修复等。

- 服务健康指标
    - 低级需求：能够正常对外提供服务。
    - 高级需求：SRE能够主动控制服务状态，而不是被动救火。

- 紧急事件
    - 
- 故障演练，灾难恢复演习，假设可能的问题发生
- 东西早晚要坏的，这就是生活。
- 事后总结，他人评审

- 敏捷性是建立在稳定性之上的

- 测试
    - 单元测试
    - 集成测试：由多个单元测试组成
    - 系统测试
        - 冒烟测试：测试核心功能
        - 性能测试
        - 回归测试：测试之前发生过的bug，保证它不会再次发生
    - 生产测试
        - 配置测试：保证生产环境的配置被正确地加载了
        - 压力测试
        - 金丝雀测试
        

维护各种线上服务的稳定性，负责保证各项服务的性能，负责管理维护数据中心。




运维：
保障业务系统的稳定性，
加快业务对应用的迭代周期，提升IT对业务的支撑能力。
给业务提供资源保障。
减少费用支出。

SRE
深度参与开发阶段工作，对应用程序的设计实现方式、依赖库、运行时的资源消耗都有严格的规约。
强调对问题和故障的自动处理，而非人工干预。
再者，按照SRE的约定，开发人员自行负责程序上线部署更新，毕竟开发人员对自己的程序更熟悉，易于处理程序上线过程遇到的问题。


传统软件工程：设计，构建软件系统。
SRE：专注于整个软件系统的生命周期管理。从设计一直到部署。

百分之百的可用性是不现实的，需要达到这个目标的成本通常远超于所能获得的价值，设置容错率，既保证用户体验又不影响创新和部署的速度。

SRE团队应该倾向于将基本的运维工作全部消除，全力投入在研发任务上。因为整个系统应该可以自主运行，可以自动修复问题。我们的终极目标是推动整个系统趋向于无人化运行，而不仅仅是自动化某些人工流程。

可用性改进，延迟优化，性能优化，效率优化，变更管理，监控，紧急事件处理以及容量规划与管理。

故障报告：事故发生，发现，解决的全过程，事故的根本原因，预防或者优化的解决方案。

如果能够通过密切关注一个服务的容量配置策略，进而改进其资源利用率，这可以非常有效地降低系统的总成本。

## 解决问题
1. 解决 创建用户，分配权限 琐事。
    - 自动化创建用户/权限分配系统
    - 核心是：通过调用jenkins、yearning等平台的接口，自动创建并且分配初始化权限。

2. 解决投放广告带来的流量激增
    - 营销系统对接K8S系统，当进行投放广告时，自动触发Pod的扩容。

3. 网站崩了，为什么终端用户不能继续进行搜索游览商品（故障容忍度）
    - 当主库崩了，切换到从库，代码开启只读模式，web界面标注维护模式，用户只能进行不需要数据库insert和update操作的行为
    - 诺出现数据库insert和update操作的行为，则提示系统维护中，需要等待一段时间

4. 
