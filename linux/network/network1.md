---
created_date: 2020-11-27
---

[TOC]

## BPF

BPF（伯克利包过滤器Berkeley Packet Filter），最初构想提出于 1992 年，其目的是为了提供一种过滤包的方法，并且要避免从内核空间到用户空间的无用的数据包复制行为。

## route

- 参考
  https://ivanzz1001.github.io/records/post/linuxops/2018/11/14/linux-route

1. Linux系统的route命令用于显示和操作IP路由表（show/manipulate the IP routing table)。

2. 要实现两个不同的子网之间的通信，需要一台连接两个网络的路由器，或者同时位于两个网络的网关来实现。

3. 在Linux系统中，设置路由通常是为了解决一个问题：该Linux系统在一个局域网中，局域网中有一个网关，能够让机器访问internet，那么就需要将网关地址设置为该Linux机器的默认路由。

4. 查看路由表 route -n
   Destination: 目标网络(network)或者目标主机(host)；’0.0.0.0’用于指示默认路由。
   Gateway: 网关地址，\*表示并未设置网关地址。
   Genmask: 子网掩码。其中’255.255.255’用于指示单一目标主机；’0.0.0.0’用于指示默认路由。

5. 指令

```bash
# 删除默认网关
route del default gw 10.0.0.254 

# 添加默认网关
route add default gw 10.0.0.254 
# 或者
route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.0.0.254

# 添加一条路由
ip route add 172.16.0.0/16 via 92.168.0.1 dev eth0
```

## 网关

1. 网关是一个逻辑概念。
2. 网关用来连接两个不同网段的网络。
3. 防火墙、路由器、三层交换机、电脑、部分MCU、一些存储设备，还有一些其它设备也可以设置成网关。

## 广播地址

1. IP
   IP=网络地址+主机地址
   通过子网掩码区分网络地址和主机地址

192.168.0.1/24
网络地址是 192.168.0.0
广播地址是 192.168.0.255
此网络内每台机器上的广播地址都是192.168.0.255

1. 单播
   单播 = 点对点通信

2. 多播
   多播 = 组播
   需要相同数据流的客户端加入相同的组共享一条数据流，服务端向组发送数据。

3. 广播
   限制：只能在一个网络段内发送数据
   功能：向所有的机器发送数据
   例子：ARP寻址
   机器A发送一个ARP广播寻找IP-1对应的MAC地址，非IP-1的机器接收到广播数据后丢弃数据，IP-1的机器收到ARP广播数据后，向对方回应数据。

## 二层三层网络协议

- 参考
  https://blog.csdn.net/SmallCatBaby/article/details/89877622

- 应用层和传输层是由软件定义的，而到了下层则是由设备厂商自己决定如何实现的，思科、华为都有自己的实现协议，都是保密的。

1. mac：网卡的硬件地址

### ARP（Address Resolution Protocol）

实现从 IP 地址到 MAC 地址的映射。
查看本地的映射：arp -a

### 动态路由协议

1. 相关协议
   RIPv1 RIPv2 ...

2. 功能：维护路由信息，建立路由表，决定最佳路由。

## 网络设备

### 交换机Switch

1. 二层网络设置。
2. 维护一张“端口-MAC地址映射表”，记录了MAC地址和交换机端口的对应关系.
3. MAC地址表的创建
   1. 机器主动发起请求的报文，Switch把源MAC和从哪一个端口收到的建立对应关系。
   2. Switch收到报文的时候如果MAC表里还没有这个目的MAC，那么就在除了收到这个报文的端口以外的其他端口进行一次洪泛，等待目的MAC的终端响应。
4. 通过mac地址进行通信。

- 相关命令
  dis arp 显示ip地址和物理地址的对应关系

### 路由器

1. 三层网络设备
2. 维护一张路由表，“目地IP地址-网关IP地址的映射表”
3. 路由表的创建
   1. 静态路由-管理员手工配置下一跳形成路由表。
   2. 动态路由-通过动态路由协议创建路由表。
4. 通过IP地址进行通信。
